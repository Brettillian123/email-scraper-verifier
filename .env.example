# =============================================================================
# Email Scraper — Environment Configuration Example
#
# Copy this file to .env and fill in your values.
# Lines starting with # are comments.  Defaults shown in (parentheses).
# =============================================================================

# -----------------------------------------------------------------------------
# Database (PostgreSQL)
# -----------------------------------------------------------------------------
# Required.  Must be a postgresql:// connection string.
# Legacy fallbacks DB_URL and DATABASE_PATH are still honoured by the code but
# should not be used for new deployments.
DATABASE_URL="postgresql://<user>:<password>@127.0.0.1:5432/email_scraper_db"

# -----------------------------------------------------------------------------
# Redis
# -----------------------------------------------------------------------------
# Used by RQ workers, caching, and rate-limiting.
# RQ_REDIS_URL falls back to REDIS_URL automatically — set only one.
REDIS_URL=redis://127.0.0.1:6379/0

# -----------------------------------------------------------------------------
# Crawl / verify identity
# -----------------------------------------------------------------------------
# User-Agent header sent when crawling websites.
USER_AGENT="EmailVerifierBot/0.9 (+mailto:you@example.com)"

# SMTP EHLO/HELO domain and MAIL FROM for SMTP probing.
SMTP_HELO_DOMAIN=verifier.example.com
SMTP_MAIL_FROM=bounce@verifier.example.com

# -----------------------------------------------------------------------------
# SMTP probe guardrails
# -----------------------------------------------------------------------------
# Set to 1 on VPS that should perform SMTP probes; leave unset or 0 elsewhere.
SMTP_PROBES_ENABLED=0
# Optional allowlist of hostnames permitted to run probes (CSV).
# SMTP_PROBES_ALLOWED_HOSTS=verifier.example.com

# -----------------------------------------------------------------------------
# Queue names
# -----------------------------------------------------------------------------
# RQ queue for email verification jobs. (verify)
QUEUE_NAME=verify
# Dead-letter queue for failed verification jobs. (verify_dlq)
DLQ_NAME=verify_dlq
# Comma-separated list of queues the worker should listen on.
RQ_QUEUE=orchestrator,crawl,generate,verify
# Queue for run orchestration jobs. (orchestrator)
RUNS_QUEUE_NAME=orchestrator

# -----------------------------------------------------------------------------
# Rate limits
# -----------------------------------------------------------------------------
# Global concurrency cap across all workers. (12)
GLOBAL_MAX_CONCURRENCY=12
# Global requests-per-second cap. (6)
GLOBAL_RPS=6
# Per-MX concurrency and RPS defaults. (2 / 1)
PER_MX_MAX_CONCURRENCY_DEFAULT=2
PER_MX_RPS_DEFAULT=1

# -----------------------------------------------------------------------------
# Retries & timeouts
# -----------------------------------------------------------------------------
# Max SMTP verification attempts per email. (5)
VERIFY_MAX_ATTEMPTS=5
# Exponential backoff base / ceiling (seconds). (2 / 90)
VERIFY_BASE_BACKOFF_SECONDS=2
VERIFY_MAX_BACKOFF_SECONDS=90
# RQ-level retry intervals (seconds, CSV). (5,15,45,90,180)
RETRY_SCHEDULE=5,15,45,90,180

# SMTP network timeouts (seconds).
# These are the canonical names — the *_SECONDS variants are deprecated aliases.
# (defaults: 5 / 10)
SMTP_CONNECT_TIMEOUT=20
SMTP_COMMAND_TIMEOUT=30

# TCP port-25 preflight knobs.
SMTP_PREFLIGHT_ENABLED=1
SMTP_PREFLIGHT_TIMEOUT_SECONDS=2
SMTP_PREFLIGHT_MAX_ADDRS=2
SMTP_PREFLIGHT_CACHE_TTL_SECONDS=1800
SMTP_MX_MAX_ADDRS=2
SMTP_PREFER_IPV4=1

# -----------------------------------------------------------------------------
# Crawler (R10)
# -----------------------------------------------------------------------------
# Max link depth from seed page. (default: 2)
CRAWL_MAX_DEPTH=1
# Max pages fetched per domain per crawl. (default: 30)
CRAWL_MAX_PAGES_PER_DOMAIN=8
# Max HTML body size to process (bytes). (default: 1500000)
CRAWL_HTML_MAX_BYTES=262144
# Seed discovery paths (CSV). (default: /,/about)
CRAWL_DISCOVERY_PATHS=/,/about,/company,/leadership,/team,/people
# Only seed paths found via link discovery? (default: false)
CRAWL_SEEDS_LINKED_ONLY=1
# Stop adding seed tiers if N pages with people data found. (default: 3)
CRAWL_SEED_STOP_MIN_PEOPLE_PAGES=2

# -----------------------------------------------------------------------------
# Ingest / HTTP auth
# -----------------------------------------------------------------------------
# Bearer token for the /ingest HTTP endpoint.
# NOTE: code reads INGEST_HTTP_TOKEN (http.py), not INGEST_TOKEN.
INGEST_HTTP_TOKEN="changeme"

# -----------------------------------------------------------------------------
# AWS / SES (O26 test-sends)
# -----------------------------------------------------------------------------
AWS_REGION=us-east-2
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# SES identity for transactional emails (verification codes, etc.).
SES_FROM_EMAIL=noreply@account.example.com
SES_FROM_NAME=YourApp
SES_AWS_REGION=us-east-2

# Test-send (O26) email configuration.
TEST_SEND_FROM=verify@verifier.example.com
TEST_SEND_REPLY_TO=verify@verifier.example.com
TEST_SEND_MAIL_FROM_DOMAIN=bounce.verifier.example.com
TEST_SEND_BOUNCE_PREFIX=bounce
TEST_SEND_SUBJECT_PREFIX="[Test]"
# Optional SQS queue URL for bounce processing.
# TEST_SEND_BOUNCES_SQS_URL=

# -----------------------------------------------------------------------------
# AI people extraction (O27)
# -----------------------------------------------------------------------------
# OpenAI API key for AI-assisted people extraction.
OPENAI_API_KEY=
# Model to use. (default: gpt-4o-mini)
AI_PEOPLE_MODEL=gpt-4o-mini
# Feature flag. (default: true)
AI_PEOPLE_ENABLED=true
# Token budget per page. (default: 1500)
AI_PEOPLE_MAX_INPUT_TOKENS=1500

# -----------------------------------------------------------------------------
# Web app / authentication
# -----------------------------------------------------------------------------
# Auth mode: "none", "dev", "hs256", or "session". (default: dev)
AUTH_MODE=session
# Secure cookie flag — set true in production behind HTTPS.
SESSION_COOKIE_SECURE=true
# Allow new user registration? (default: true)
REGISTRATION_ENABLED=true
# Default tenant ID for new users. (default: dev)
DEFAULT_TENANT_ID=default
# Public-facing URL (used in emails, redirects, etc.).
APP_URL=https://example.com

# Dev-mode fallback identity (only used when AUTH_MODE=dev).
DEV_TENANT_ID=dev
DEV_USER_ID=user_dev

# For hs256 auth mode — generate with: openssl rand -hex 32
# AUTH_HS256_SECRET=
# AUTH_JWT_ISSUER=
# AUTH_JWT_AUDIENCE=

# -----------------------------------------------------------------------------
# Optional / advanced
# -----------------------------------------------------------------------------
# Third-party fallback email verification (O07).
# THIRD_PARTY_VERIFY_URL=
# THIRD_PARTY_VERIFY_API_KEY=

# Facets materialized view (O14/R23). (default: false)
# FACET_USE_MV=false

# Lead search cache. (default: enabled, 900s TTL)
# LEAD_SEARCH_CACHE_ENABLED=1
# LEAD_SEARCH_CACHE_TTL_SECONDS=900

# Admin API key (if needed).
# ADMIN_API_KEY=
# ADMIN_ALLOWED_IPS=
