# .env.example
# -----------------------------------------------------------------------------
# Email Scraper / Verifier â€” Example Environment Configuration
#
# Target state (Postgres-first / multi-user):
# - PostgreSQL is the ONLY system of record (no SQLite in production).
# - Local (Windows) runs HTTP-only work (crawl/extract/generate/ingest) and enqueues jobs.
# - VPS runs RQ worker(s) for MX/SMTP/catch-all (TCP/25 allowed) and writes results to Postgres.
#
# Critical requirement:
# - Local and VPS MUST point to the SAME DATABASE_URL (recommended: Postgres on VPS)
# - For local access without exposing ports publicly: use SSH tunnels to VPS Postgres+Redis
#
# Example SSH tunnel (run in a dedicated PowerShell window and keep open):
#   ssh -N `
#     -L 5432:127.0.0.1:5432 `
#     -L 6379:127.0.0.1:6379 `
#     root@verifier.crestwellpartners.com
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Runtime
# -----------------------------------------------------------------------------
ENV=dev
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# Database (shared between Windows and VPS)
#
# Recommended (shared Postgres on VPS; Windows connects via SSH tunnel):
# - If using the SSH tunnel above, host should be 127.0.0.1 and port 5432.
# - If connecting directly from the VPS (no tunnel), use the VPS-local host (often 127.0.0.1).
#
# Example:
#   DATABASE_URL=postgresql://<user>:<pass>@127.0.0.1:5432/<db>
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql://<user>:<pass>@127.0.0.1:5432/<db>

# Compatibility (some modules/tests reference DB_URL)
# Keep DB_URL aligned with DATABASE_URL.
DB_URL=postgresql://<user>:<pass>@127.0.0.1:5432/<db>

# Legacy SQLite fallback (DEPRECATED; do not use for VPS worker model; remove when fully migrated)
# DATABASE_URL=sqlite:///C:/path/to/email-scraper/data/dev.db
# DB_URL=sqlite:///C:/path/to/email-scraper/data/dev.db

# -----------------------------------------------------------------------------
# Redis (shared between Windows and VPS)
#
# Recommended with SSH tunnel from Windows -> VPS:
# REDIS_URL=redis://127.0.0.1:6379/0
# -----------------------------------------------------------------------------
REDIS_URL=redis://127.0.0.1:6379/0

# RQ uses this explicitly in parts of the codebase
RQ_REDIS_URL=redis://127.0.0.1:6379/0

# -----------------------------------------------------------------------------
# Identity for crawling/verifying
# -----------------------------------------------------------------------------
USER_AGENT=EmailVerifierBot/0.1 (+mailto:you@yourdomain.com)

# SMTP identity used by SMTP probing logic
SMTP_HELO_DOMAIN=verifier.crestwellpartners.com
SMTP_MAIL_FROM=bounce@iqverifier.xyz

# -----------------------------------------------------------------------------
# SMTP probing guardrail
#
# Local/dev: leave SMTP_PROBES_ENABLED unset OR set to 0
# VPS verifier: set SMTP_PROBES_ENABLED=1
# Optional allowlist prevents accidental enabling on the wrong host.
# -----------------------------------------------------------------------------
SMTP_PROBES_ENABLED=0
SMTP_PROBES_ALLOWED_HOSTS=verifier.crestwellpartners.com,verifier

# -----------------------------------------------------------------------------
# Queue names
# -----------------------------------------------------------------------------
QUEUE_NAME=verify
DLQ_NAME=verify_dlq

# -----------------------------------------------------------------------------
# Rate limits
# -----------------------------------------------------------------------------
GLOBAL_MAX_CONCURRENCY=12
GLOBAL_RPS=6
PER_MX_MAX_CONCURRENCY_DEFAULT=2
PER_MX_RPS_DEFAULT=1

# -----------------------------------------------------------------------------
# Retries & timeouts
# -----------------------------------------------------------------------------
VERIFY_MAX_ATTEMPTS=5
VERIFY_BASE_BACKOFF_SECONDS=2
VERIFY_MAX_BACKOFF_SECONDS=90

# Optional: RQ-level retry schedule (seconds); used by enqueue helper
RETRY_SCHEDULE=5,15,45,90,180

# SMTP network timeouts (seconds)
SMTP_CONNECT_TIMEOUT_SECONDS=20
SMTP_CMD_TIMEOUT_SECONDS=30

# Legacy env var names still supported in parts of the codebase
# SMTP_CONNECT_TIMEOUT=20
# SMTP_COMMAND_TIMEOUT=30

# Optional SMTP preflight fast-fail knobs (if used in your build)
SMTP_PREFLIGHT_ENABLED=1
SMTP_PREFLIGHT_TIMEOUT_SECONDS=2
SMTP_PREFLIGHT_MAX_ADDRS=2
SMTP_PREFLIGHT_CACHE_TTL_SECONDS=1800
SMTP_MX_MAX_ADDRS=2
SMTP_PREFER_IPV4=1

# -----------------------------------------------------------------------------
# R10 crawler
# -----------------------------------------------------------------------------
CRAWL_MAX_DEPTH=1
CRAWL_MAX_PAGES_PER_DOMAIN=8
CRAWL_HTML_MAX_BYTES=262144
CRAWL_DISCOVERY_PATHS=/,/about,/company,/leadership,/team,/people
CRAWL_SEEDS_LINKED_ONLY=1
CRAWL_SEED_STOP_MIN_PEOPLE_PAGES=2

# -----------------------------------------------------------------------------
# Ingest / auth tokens (if applicable)
# -----------------------------------------------------------------------------
INGEST_TOKEN=

# -----------------------------------------------------------------------------
# AWS / SES (O26 test-sends)
# -----------------------------------------------------------------------------
AWS_REGION=us-east-2
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Test-send config
TEST_SEND_FROM=verify@iqverifier.xyz
TEST_SEND_REPLY_TO=verify@iqverifier.xyz
TEST_SEND_MAIL_FROM_DOMAIN=bounce.iqverifier.xyz
TEST_SEND_BOUNCE_PREFIX=bounce
TEST_SEND_SUBJECT_PREFIX=[IQVerifier Test]

# SES bounce SQS queue (optional)
TEST_SEND_BOUNCES_SQS_URL=

# -----------------------------------------------------------------------------
# O27: OpenAI / AI people extraction
# -----------------------------------------------------------------------------
OPENAI_API_KEY=
AI_PEOPLE_MODEL=gpt-4o-mini
AI_PEOPLE_ENABLED=false
AI_PEOPLE_MAX_INPUT_TOKENS=1500
